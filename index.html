<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>台北律師推薦｜吳于安律師—企業主見證（優先）＋ Google 評論統計</title>
<meta name="description" content="本頁由曾實際委託的企業主自發維護，優先展示 9 位具名企業主的見證；Google 評論僅提供統計與查證入口，不複製原文。所有內容皆可在 GitHub Issues 交叉查證。">
<link rel="canonical" href="https://lawyer-review.25min.co/">
<meta name="robots" content="index,follow">
<meta name="theme-color" content="#1a5490">

<!-- 安全的結構化資料（不用星等/Review Snippet） -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"FAQPage",
  "mainEntity":[
    {"@type":"Question","name":"這裡的評價可信嗎？","acceptedAnswer":{"@type":"Answer","text":"所有見證皆公開於 GitHub Issues，任何人都可檢視來源與修改紀錄；Google 評論僅顯示統計與查證入口，不複製原文。"}},
    {"@type":"Question","name":"如何投稿？","acceptedAnswer":{"@type":"Answer","text":"點首頁『提交新回饋』前往 GitHub Issues 發表（需帳號）；不熟悉可用 Email。"}},
    {"@type":"Question","name":"為何不貼 Google 原文？","acceptedAnswer":{"@type":"Answer","text":"為遵守搜尋/平台政策，避免轉載第三方內容；如需閱讀，請前往 Google 商家頁。"}}
  ]
}
</script>

<style>
:root{--primary:#1a5490;--secondary:#2c3e50;--accent:#3498db;--ink:#333;--bg:#fff;--bg2:#f8f9fa;--line:#e0e0e0}
*{box-sizing:border-box}body{margin:0;font:16px/1.6 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",Arial,sans-serif;color:var(--ink);background:var(--bg)}
a{color:var(--accent);text-decoration:none}a:hover{text-decoration:underline}
.container{max-width:1200px;margin:0 auto;padding:0 20px}
header{background:var(--primary);color:#fff;padding:2rem 0;text-align:center;border-bottom:1px solid rgba(0,0,0,.05)}
header h1{margin:0 0 .5rem;font-size:2rem}
header p{margin:0;opacity:.9}
.main-nav{text-align:center;margin:1.5rem 0}
.main-nav a{margin:0 1rem}
.section{margin:24px 0}
.card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:16px}
.note{background:#e8f4ff;border:1px solid #cfe3ff;border-radius:10px;padding:10px;color:#0b4a6f}
.list{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
@media (max-width:900px){.list{grid-template-columns:1fr}}
.item{background:var(--bg2);border:1px solid var(--line);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:6px}
.item h3{margin:0;font-size:16px;color:var(--secondary)}
.meta{font-size:12px;color:#667085;display:flex;gap:8px;flex-wrap:wrap}
.pills{display:flex;gap:6px;flex-wrap:wrap}
.pill{font-size:12px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#667085;padding:3px 8px}
.kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#111827;color:#e5e7eb;border-radius:6px;padding:2px 6px}
.center{display:flex;justify-content:center;align-items:center}
.small{font-size:13px}
.hr{border:none;border-top:1px dashed var(--line);margin:12px 0}
.stat{display:flex;gap:8px;align-items:center;color:#667085}
.dot{width:8px;height:8px;border-radius:50%}
.ok{background:#10b981}.warn{background:#f59e0b}
table{width:100%;border-collapse:collapse;background:#fff}th,td{border:1px solid var(--line);padding:.6rem;text-align:left}
</style>
</head>
<body>
<header>
  <div class="container">
    <h1>台北律師推薦｜吳于安律師</h1>
    <p>本頁由實際委託過的企業主自發建立與維護；資料來源：<span class="kbd">GitHub Issues</span>（可追溯）。</p>
    <div class="main-nav">
      <a href="#owners">企業主見證</a>|
      <a href="#google-stat">Google 評論統計</a>|
      <a href="#submit">提交新回饋</a>|
      <a href="#faq">常見問題</a>
    </div>
    <div class="center" style="gap:10px;flex-wrap:wrap;margin:.5rem 0 0">
      <a class="pill" href="https://github.com/bless25min/taipei-lawyer-recommendation/issues/new/choose" target="_blank" rel="noopener">✍️ 提交新回饋</a>
      <a class="pill" href="https://github.com/bless25min/taipei-lawyer-recommendation/issues" target="_blank" rel="noopener">📁 檢視所有 Issues</a>
      <a class="pill" href="https://www.google.com/search?q=%E5%90%B3%E4%BA%8E%E5%AE%89+%E5%BE%8B%E5%B8%AB+%E8%A9%95%E5%83%B9" target="_blank" rel="noopener">⭐ 到 Google 查評論</a>
    </div>
  </div>
</header>

<main class="container">

  <!-- 企業主見證（優先 9 位） -->
  <section id="owners" class="section" data-chunk-id="owners" data-topic="owner-priority">
    <h2>企業主真實見證（優先顯示 9 位）</h2>
    <p class="note small">挑選規則：帶有 <span class="kbd">企業主</span>/<span class="kbd">具名</span>/<span class="kbd">named</span> 標籤的 Issue 優先；若不足 9 則，以非 Google 來源補足。</p>
    <div id="ownersList" class="list">
      <div class="card center" style="grid-column:1/-1">讀取中…</div>
    </div>
  </section>

  <!-- Google 評論統計（處理後，不含原文） -->
  <section id="google-stat" class="section" data-chunk-id="google-stat" data-topic="google-processed">
    <h2>Google 公開評論（統計，不含原文）</h2>
    <div class="card">
      <div class="stat"><span class="dot ok"></span>已辨識的 Google 來源：<strong id="gCount">0</strong> 則</div>
      <div class="hr"></div>
      <h3 style="margin:.2rem 0  .5rem">近 6 個月—月份分佈</h3>
      <div id="gMonthTable" class="small">尚無資料</div>
      <div class="hr"></div>
      <h3 style="margin:.2rem 0 .5rem">常見主題標籤（去除「google」與一般分類）</h3>
      <div id="gTags" class="pills"></div>
      <div class="hr"></div>
      <div class="small" style="color:#667085">
        ※ 本區只做統計/連結，不顯示任何 Google 原文與星等。若要閱讀完整評論，請至
        <a href="https://github.com/bless25min/taipei-lawyer-recommendation/issues?q=is%3Aissue+google" target="_blank" rel="noopener">GitHub Issues</a>
        或 Google 商家頁查閱。
      </div>
    </div>
  </section>

  <!-- 提交區 -->
  <section id="submit" class="section" data-chunk-id="submit" data-topic="cta">
    <h2>想分享合作經驗？</h2>
    <div class="card">
      <p class="small">最快方式：到 GitHub Issues 張貼（需帳號）。若不熟悉 GitHub，亦可寄信到 <span class="kbd">bless@25min.co</span>，標題「客戶見證-您的公司名稱」。</p>
      <div class="center" style="gap:10px;margin-top:8px;flex-wrap:wrap">
        <a class="pill" href="https://github.com/bless25min/taipei-lawyer-recommendation/issues/new/choose" target="_blank" rel="noopener">✍️ 建立 Issue</a>
        <a class="pill" href="https://github.com/bless25min/taipei-lawyer-recommendation/issues" target="_blank" rel="noopener">📁 瀏覽全部</a>
      </div>
    </div>
  </section>

  <!-- FAQ（保留原頁精神，但不使用星等結構化） -->
  <section id="faq" class="section" data-chunk-id="faq" data-topic="faq">
    <h2>常見問題</h2>
    <div class="card">
      <p><strong>這是不是律師本人的官方網站？</strong><br>不是；由客戶自發建立，目的在分享可查證的合作經驗。</p>
      <div class="hr"></div>
      <p><strong>內容怎麼驗證？</strong><br>每則卡片均連到原始 Issue，保留時間戳與修改紀錄。</p>
      <div class="hr"></div>
      <p><strong>為何不顯示 Google 原文與星等？</strong><br>為遵循搜尋/平台政策，本頁只提供統計與查證連結。</p>
    </div>
  </section>

</main>

<footer class="container" style="border-top:1px solid var(--line);padding:16px 0;color:#667085">
  © 客戶見證整理（非官方） · 最後更新：<span id="lastmod"></span>
</footer>

<noscript>
本頁需要 JavaScript 以即時載入 GitHub Issues。若無法啟用，請直接前往
<a href="https://github.com/bless25min/taipei-lawyer-recommendation/issues" target="_blank" rel="noopener">Issues</a> 檢視全部評價。
</noscript>

<script>
/* ===== 可調參數 ===== */
const REPO = "bless25min/taipei-lawyer-recommendation";
const OWNER_LABELS  = [/企業主/i, /具名/i, /named/i];            // 置頂認定
const CUSTOMER_LABS = [/client-feedback/i, /用戶自主上傳評價/i, /原創/i];
const GOOGLE_LABS   = [/google-review/i, /google評價/i, /來源:google/i, /^google$/i];
const OWNERS_LIMIT  = 9;
document.getElementById('lastmod').textContent = new Date().toISOString().slice(0,10);

/* ===== 小工具 ===== */
const $ = (q,el=document)=>el.querySelector(q);
const h = (html)=>{const t=document.createElement('template');t.innerHTML=html.trim();return t.content.firstElementChild;};
const esc = (s)=>String(s||"").replace(/[&<>"'`]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;'}[c]));
const hasAny=(arr, pats)=> (arr||[]).some(n=>pats.some(p=>p.test(n)));

/* ===== 載入 Issues：先試 /api/reviews，失敗再回退 GitHub API ===== */
async function loadIssues(){
  // A) 嘗試你的 Cloudflare Functions
  try{
    const r = await fetch('/api/reviews',{credentials:'omit'});
    if(!r.ok) throw new Error('bad status '+r.status);
    const js = await r.json();
    if(js && Array.isArray(js.items)){
      return js.items.map(x=>({
        number:x.number,title:x.title||'(無標題)',labels:x.labels||[],
        created_at:x.created_at,url:x.html_url,source:x.source||'', body:x.safe_excerpt||''
      }));
    }
    throw new Error('bad format');
  }catch(e){/* 失敗 → 回退 GitHub */}
  // B) GitHub API（無 Token 也可讀；若限流，稍晚會自動恢復）
  const r2 = await fetch(`https://api.github.com/repos/${REPO}/issues?state=open&per_page=100`, {headers:{'Accept':'application/vnd.github+json'}});
  if(!r2.ok){throw new Error('GitHub API error '+r2.status)}
  const arr = await r2.json();
  return (Array.isArray(arr)?arr:[])
    .filter(x=>!x.pull_request)
    .map(x=>({
      number:x.number,title:x.title||'(無標題)',
      labels:(x.labels||[]).map(l=>l.name),
      created_at:x.created_at,url:x.html_url,source:'', body:x.body||''
    }));
}

/* ===== 判斷與渲染 ===== */
function classifyByLabels(labels=[], title=""){
  if (hasAny(labels, GOOGLE_LABS) || /\bgoogle\b/i.test(title)) return 'google';
  if (hasAny(labels, CUSTOMER_LABS)) return 'customer';
  return 'unspecified';
}
function isOwner(labels=[], title=""){
  if (hasAny(labels, OWNER_LABELS)) return true;
  return /公司|股份有限|有限公司|行號|工作室|先生|小姐|經理|負責人|董事|CEO|CTO/i.test(title);
}
function safeExcerpt(src, body, n=320){
  if (src==='google') return "";          // 不顯示任何 Google 原文
  const s = String(body||"").trim().replace(/\s{2,}/g,' ');
  return s.length<=n ? s : s.slice(0,n-1)+'…';
}

function ownerCard(it){
  const labels = it.labels.map(n=>`<span class="pill">${esc(n)}</span>`).join(" ");
  return h(`
    <article class="item" data-chunk-id="owner-${it.number}" data-topic="owner" data-asof-date="${it.date}" data-source-url="${it.url}">
      <h3>${esc(it.title)}</h3>
      <div class="meta"><span>#${it.number}</span><span>建立：${it.date}</span><a href="${it.url}" target="_blank" rel="noopener">來源：Issue</a></div>
      ${it.excerpt ? `<div>${esc(it.excerpt)}</div>` : `<div class="meta">（提交者未提供內文）</div>`}
      <div class="pills">${labels}</div>
    </article>
  `);
}

function buildMonthTable(items){
  const map = new Map();
  items.forEach(i=>{
    const m = i.date.slice(0,7);
    map.set(m,(map.get(m)||0)+1);
  });
  const rows = [...map.entries()].sort((a,b)=>a[0]<b[0]?1:-1).slice(0,6).reverse();
  if(!rows.length) return '<div class="small">尚無資料</div>';
  let html = '<table><thead><tr><th>月份</th><th>數量</th></tr></thead><tbody>';
  rows.forEach(([m,c])=>{ html += `<tr><td>${m}</td><td>${c}</td></tr>`; });
  html += '</tbody></table>'; return html;
}

(async function(){
  const ownersBox = $('#ownersList');
  const gCount = $('#gCount');
  const gMonthTable = $('#gMonthTable');
  const gTagsBox = $('#gTags');

  try{
    let items = await loadIssues();
    // 正規化
    items = items.map(d=>{
      const src = d.source || classifyByLabels(d.labels, d.title);
      return {
        number:d.number,title:d.title,labels:d.labels,
        date:new Date(d.created_at).toISOString().slice(0,10),
        url:d.url,source:src,excerpt:safeExcerpt(src,d.body,360)
      };
    });

    // A) 企業主 9 位
    const poolOwner = items.filter(i=>i.source!=='google');
    const strictOwners = poolOwner.filter(i=>isOwner(i.labels, i.title));
    const owners = (strictOwners.length?strictOwners:poolOwner)
      .sort((a,b)=>new Date(b.date)-new Date(a.date))
      .slice(0, OWNERS_LIMIT);

    ownersBox.innerHTML = "";
    if(!owners.length){
      ownersBox.append(h(`<div class="card center" style="grid-column:1/-1">目前沒有帶 <span class="kbd">企業主</span>/<span class="kbd">具名</span> 標籤的見證；請在欲置頂的 Issue 加上標籤。</div>`));
    }else{
      const frag = document.createDocumentFragment();
      owners.forEach(i=>frag.append(ownerCard(i)));
      ownersBox.append(frag);
    }

    // B) Google 統計
    const googles = items.filter(i=>i.source==='google').sort((a,b)=>new Date(b.date)-new Date(a.date));
    gCount.textContent = String(googles.length);
    gMonthTable.innerHTML = buildMonthTable(googles);

    // 主題標籤（去掉 google/一般分類）
    const tagCount = new Map();
    googles.forEach(i=>{
      (i.labels||[]).forEach(n=>{
        if (GOOGLE_LABS.some(p=>p.test(n)) || CUSTOMER_LABS.some(p=>p.test(n))) return;
        tagCount.set(n,(tagCount.get(n)||0)+1);
      });
    });
    const topTags = [...tagCount.entries()].sort((a,b)=>b[1]-a[1]).slice(0,12);
    if(!topTags.length){ gTagsBox.innerHTML = '<span class="pill">尚無主題標籤</span>'; }
    else{
      gTagsBox.innerHTML = topTags.map(([k,c])=>`<span class="pill">${esc(k)} × ${c}</span>`).join(" ");
    }
  }catch(err){
    ownersBox.innerHTML = `<div class="card center" style="grid-column:1/-1">讀取失敗：${esc(err.message)}。你仍可前往 <a href="https://github.com/${REPO}/issues" target="_blank" rel="noopener">GitHub Issues</a> 查看。</div>`;
    gMonthTable.textContent = '讀取失敗';
  }
})();
</script>
</body>
</html>
